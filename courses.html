<!DOCTYPE html>
<html>
<head>
  <title>Redirecting...</title>
</head>
<body>
  <h2>Checking your course access...</h2>

  <script type="module">
    import { auth, db } from './firebase.js';
    import { onAuthStateChanged } from 'https://www.gstatic.com/firebasejs/9.22.2/firebase-auth.js';
    import { doc, getDoc } from 'https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore.js';

    onAuthStateChanged(auth, async (user) => {
      if (!user) {
        window.location.href = "login.html";
        return;
      }

      const uid = user.uid;
      const ref = doc(db, "userPurchases", uid);
      const snap = await getDoc(ref);

      // Example logic: You can change this to redirect based on multiple purchases too
      const purchased = snap.exists() ? snap.data().purchasedCourses || [] : [];

      const course = "course1"; // default course you're checking
      const redirectTo = purchased.includes(course)
        ? `${course}-premium.html`
        : `${course}-basic.html`;

      window.location.href = redirectTo;
    });
  </script>
</body>
</html>
